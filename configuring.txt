sudo yum install git
#sudo yum install postgresql-server
#sudo yum install postgresql-contrib

# install py3

sudo yum install centos-release-scl
sudo yum install rh-python36
scl enable rh-python36 bash

#install pip

sudo yum groupinstall 'Development Tools'
# pip is not on secure_path
sudo /opt/rh/rh-python36/root/usr/bin/pip install --upgrade pip
sudo /opt/rh/rh-python36/root/usr/bin/pip install pipenv

# create autocat user with home directory /var/lib/autocat

sudo useradd -d /var/lib/ autocat
sudo passwd autocat
sudo su - autocat

# create ~/.ssh/id_rsa and ~/.ssh/id_rsa.pub using app key from the gutenbergtools/autocat3 repo
# id_rsa should have permissions 600
mkdir .ssh
install -m 600 .ssh/id_rsa
touch .ssh/id_rsa.pub
#!! from local
# scp [local:]~.ssh/github [autocat@host:]~/.ssh/id_rsa
# scp [local:]~.ssh/github.pub [autocat@host:]~/.ssh/id_rsa.pub
chmod 600 .ssh/id_rsa

#set default python
scl enable rh-python36 bash
echo 'source scl_source enable rh-python36' >> /var/lib/autocat/.bash_profile

git clone git@github.com:gutenbergtools/autocat3.git
cd autocat3
pipenv --three
#git checkout remotes/origin/dev
git checkout remotes/origin/remove-ratelimit
pipenv install

# add conf file
#!! from local
# scp [local:]~/autocat3.conf [autocat@host:]~/.autocat

mkdir /var/lib/autocat/log/

exit

sudo mkdir /var/run/autocat
sudo touch /var/run/autocat/autocat3.pid
sudo chown autocat /var/run/autocat/autocat3.pid

sudo systemctl enable /var/lib/autocat/autocat3/autocat3.service
sudo systemctl start autocat3

